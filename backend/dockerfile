# ---- builder ----
    FROM python:3.12-slim AS builder
    WORKDIR /app
    ENV PIP_NO_CACHE_DIR=1 PIP_DISABLE_PIP_VERSION_CHECK=1
    
    COPY requirements.txt .
    RUN python -m venv /opt/venv \
     && . /opt/venv/bin/activate \
     && pip install --upgrade pip \
     && pip install --index-url https://download.pytorch.org/whl/cpu \
          torch==2.7.0 torchvision==0.22.0 \
     && pip install -r requirements.txt \
     && python - <<'PY'
    import torch, torchvision
    print("torch:", torch.__version__)
    print("torchvision:", torchvision.__version__)
    PY
    
    # ---- runner ----
    FROM python:3.12-slim AS runner
    WORKDIR /app
    ENV PATH="/opt/venv/bin:$PATH" PYTHONUNBUFFERED=1
    COPY --from=builder /opt/venv /opt/venv
    COPY index.py ./index.py
    COPY flooplan_detector.py ./flooplan_detector.py
    EXPOSE 5050
    CMD ["/opt/venv/bin/python", "index.py"]
    